<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Chat v·ªõi AI - Tr·ª£ L√Ω H·ªçc T·∫≠p & AI</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap" rel="stylesheet">
  <style>
    html, body { height: 100%; min-height: 100%; }
    body {
      background: var(--bg1, #f4f9ff);
      margin: 0; padding: 0;
      min-height: 100vh; display: flex; flex-direction: column;
    }
    main {
      flex: 1 0 auto;
      display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
      width: 100%;
      min-height: 70vh;
      margin: 0; padding: 0;
    }
    /* Header mini */
    .mini-header {
      display: flex; align-items: center;
      background: #fff;
      box-shadow: 0 1px 8px #185adb09;
      height: 50px; min-height: 40px;
      padding: 0 22px;
      border-bottom: 1.2px solid #e3e9f7;
      position: sticky; top: 0; left: 0; right: 0; z-index: 30;
    }
    .mini-logo {width: 29px; height: 29px; border-radius:50%; margin-right: 10px;}
    .mini-title {font-weight:700; font-size:1.09rem; color:#185adb;}
    /* Box chat g·∫ßn nh∆∞ full width */
    .chat-main-card {
      width: 100%; max-width: 1020px;
      margin: 32px auto 24px auto;
      background: #fff;
      border-radius: 23px;
      box-shadow: 0 6px 36px #185adb13;
      display: flex; flex-direction: column;
      padding: 0;
    }
    .mini-title-bar {
      font-weight: 700; color: #185adb;
      padding: 16px 0 0 0; text-align: left; font-size: 1.08rem;
      letter-spacing: .2px; margin-left:38px; margin-bottom:2px;
      display: flex; align-items: center; gap: 8px;
    }
    .mini-title-bar .icon {width: 22px; height: 22px; border-radius: 50%; background: #eaf3ff;}
    .api-btns-group {
      margin-left:auto; display:flex; gap:7px; font-size:0.95rem;
    }
    .api-btn, .getkey-btn {
      background: #f4f7fe; color: #185adb; border: 1px solid #b7d2fa; border-radius: 7px;
      padding: 4px 13px; font-weight: 600; font-size: 0.99rem; cursor: pointer; transition: background 0.13s; text-decoration:none;
      display: flex; align-items: center; gap: 5px; margin-left:5px;
    }
    .api-btn:hover, .getkey-btn:hover {background:#e7f0ff;}
    .mode-switcher {
      display: flex; gap: 0; margin: 0 0 7px 0; border-bottom:1.3px solid #e5eefa; background: #fff;
      justify-content: flex-start; padding-left:38px;
    }
    .mode-btn {
      border: none; background: none;
      padding: 16px 38px 12px 38px;
      font-weight: 600; color: #97a4c1; font-size: 1.09rem;
      cursor: pointer; border-bottom: 2.5px solid transparent; outline: none;
      transition: all .15s;
    }
    .mode-btn.active, .mode-btn:focus {
      color: #185adb; border-bottom: 2.5px solid #185adb; background: #f7faff;
    }
    .chat-body {
      flex: 1; padding: 0; overflow-y: auto; background: #f7faff;
      border-radius: 0 0 23px 23px;
      display: flex; flex-direction: column;
      min-height: 420px;
    }
    .chat-messages {
      padding: 36px 48px 8px 48px;
      overflow-y: auto; flex: 1;
      min-height: 340px;
      font-size: 1.11rem;
      display: flex; flex-direction: column;
      gap: 7px;
    }
    .msg-row {display: flex;}
    .msg-bubble {
      max-width: 80vw; min-width: 50px;
      padding: 13px 19px;
      border-radius: 16px;
      font-size: 1.13rem;
      line-height: 1.7;
      box-shadow: 0 1px 8px #185adb0b;
      white-space: pre-line;
      margin-bottom: 3px;
      word-break: break-word;
    }
    .msg-user {justify-content: flex-end;}
    .msg-user .msg-bubble {
      background: linear-gradient(110deg, #185adb 0%, #356ad2 100%);
      color: #fff; border-bottom-right-radius: 7px;
    }
    .msg-ai {justify-content: flex-start;}
    .msg-ai .msg-bubble {
      background: #eaf3ff;
      color: #222; border-bottom-left-radius: 7px;
    }
    .chat-input-bar {
      display: flex; align-items: flex-end;
      gap: 13px; background: #f4f7fa;
      padding: 24px 44px 32px 44px;
      border-radius: 0 0 23px 23px;
      border-top: 1.3px solid #e7f0ff;
      box-shadow: 0 0.5px 0 #e6eef9;
    }
    .chat-input-bar input {
      flex: 1; font-size: 1.15rem; padding: 16px 18px; border-radius: 16px;
      border: 1.7px solid #bdd1f6; outline:none; box-shadow:0 1.5px 8px #185adb09;
      background: #fff; transition: border 0.16s;
    }
    .chat-input-bar input:focus {border:1.7px solid #185adb;}
    .chat-input-bar button {
      padding: 0 0 0 0; border: none; background: none;
      width: 52px; height: 52px; border-radius: 50%;
      background: #185adb; color: #fff;
      font-size: 1.45rem; display:flex; align-items:center;justify-content:center;
      cursor:pointer; box-shadow:0 2px 10px #185adb1a;
      transition: background 0.13s;
    }
    .chat-input-bar button:active {background:#153772;}
    /* Footer */
    #footer { flex-shrink: 0; margin-top: 24px; }
    @media (max-width:1200px) {.chat-main-card{max-width:99vw;}}
    @media (max-width:750px) {
      .chat-main-card {margin:9px 2vw; border-radius:17px;}
      .chat-messages {padding:13px 2vw 7px 2vw;}
      .chat-input-bar {padding:7px 2vw 14px 2vw; border-radius:0 0 17px 17px;}
      .mode-switcher{padding-left:0;}
    }
  </style>
</head>
<body>
  <!-- Header mini -->
  <header class="mini-header">
    <img src="logo.png" alt="Logo" class="mini-logo">
    <span class="mini-title">Tra C·ª©u H·ªçc Thu·∫≠t & AI</span>
  </header>
  <main>
    <div class="chat-main-card">
      <div class="mini-title-bar">
        <img class="icon" src="icon-ai.png" alt="AI">
        <span>Tr·ª£ l√Ω AI h·ªçc t·∫≠p</span>
        <div class="api-btns-group" id="api-btns-group"></div>
      </div>
      <div class="mode-switcher">
        <button class="mode-btn active" onclick="switchMode('chatbase')">Chatbase</button>
        <button class="mode-btn" onclick="switchMode('gpt')">Chat GPT</button>
        <button class="mode-btn" onclick="switchMode('gemini')">Chat Gemini</button>
      </div>
      <div class="chat-body">
        <div id="chatbase-chat" class="chat-messages" style="display:block;text-align:center;">
          <iframe src="https://www.chatbase.co/chatbot-iframe/LqqF_1Q5mDRgBiRX2Kpb_" width="98%" height="420"
            style="border-radius:13px;border:1.5px solid #eee;background:#fff;box-shadow:0 4px 16px #185adb17;"
            allow="clipboard-write"></iframe>
        </div>
        <div id="gpt-chat" class="chat-messages" style="display:none;"></div>
        <div id="gemini-chat" class="chat-messages" style="display:none;"></div>
      </div>
      <div class="chat-input-bar" id="chatbase-input" style="display:none;"></div>
      <div class="chat-input-bar" id="gpt-input" style="display:none;">
        <input id="userMsg-gpt" type="text" placeholder="Nh·∫≠p c√¢u h·ªèi..." autocomplete="off" onkeydown="if(event.key==='Enter'){sendMsgGPT();}">
        <button onclick="sendMsgGPT()"><span>&#10148;</span></button>
      </div>
      <div class="chat-input-bar" id="gemini-input" style="display:none;">
        <input id="userMsg-gemini" type="text" placeholder="Nh·∫≠p c√¢u h·ªèi..." autocomplete="off" onkeydown="if(event.key==='Enter'){sendMsgGemini();}">
        <button onclick="sendMsgGemini()"><span>&#10148;</span></button>
      </div>
    </div>
  </main>
  <!-- Footer lu√¥n hi·ªán r√µ r√†ng cu·ªëi body -->
  <div id="footer"></div>
  <script>
    // Import footer (n·∫øu c·∫ßn l·∫•y t·ª´ file ngo√†i)
    fetch('footer.html').then(r=>r.text()).then(d=>{document.getElementById('footer').innerHTML=d});
    // C√°c h√†m JS x·ª≠ l√Ω tab v√† API key nh∆∞ c√°c v√≠ d·ª• tr∆∞·ªõc (renderApiBtns, switchMode, ... nh∆∞ tr√™n)
    let chatMode = 'chatbase';
    function renderApiBtns(mode) {
      const group = document.getElementById('api-btns-group');
      if(!group) return group.innerHTML = "";
      group.innerHTML = '';
      if(mode==='gpt') {
        group.innerHTML = `
          <a class="getkey-btn" href="https://platform.openai.com/settings/organization/api-keys" target="_blank">üîó L·∫•y GPT Key</a>
          <button class="api-btn" onclick="openAPIKeyPopup('gpt')">üîë Nh·∫≠p GPT Key</button>
        `;
      } else if(mode==='gemini') {
        group.innerHTML = `
          <a class="getkey-btn" href="https://aistudio.google.com/apikey" target="_blank">üîó L·∫•y Gemini Key</a>
          <button class="api-btn" onclick="openAPIKeyPopup('gemini')">üîë Nh·∫≠p Gemini Key</button>
        `;
      }
    }
    function switchMode(mode) {
      chatMode = mode;
      document.querySelectorAll('.mode-btn').forEach((el,i)=>{
        el.classList.toggle('active', (['chatbase','gpt','gemini'][i]===mode));
      });
      document.getElementById('chatbase-chat').style.display = mode==='chatbase'?'block':'none';
      document.getElementById('chatbase-input').style.display = 'none';
      document.getElementById('gpt-chat').style.display = mode==='gpt'?'block':'none';
      document.getElementById('gpt-input').style.display = mode==='gpt'?'flex':'none';
      document.getElementById('gemini-chat').style.display = mode==='gemini'?'block':'none';
      document.getElementById('gemini-input').style.display = mode==='gemini'?'flex':'none';
      renderApiBtns(mode);
      scrollToBottom();
    }
    // ==== C√°c h√†m nh·∫≠p API key, chat GPT/Gemini ... gi·ªØ nguy√™n ====
    // ... (copy l·∫°i ph·∫ßn JS t·ª´ c√°c m·∫´u tr∆∞·ªõc) ...
    // Kh·ªüi t·∫°o ƒë√∫ng n√∫t key
    window.onload = ()=>{renderApiBtns('chatbase');}
  </script>
</body>
</html>
